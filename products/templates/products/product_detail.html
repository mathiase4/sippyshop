{% extends 'base.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block title %}{{ product.name }}{% endblock %}

<!-- ADD CSS STYLE FROM PRODUCT_DETAIL.CSS FILE PAGE-->
 {% block extra_css %}
<link rel="stylesheet" href="{% static 'css/product_detail.css' %}">
{% endblock %}


{% block content %}
<div class="product-detail-container">
    <!-- back to product link -->
     <a href="{% url 'product_list' %}" class="back-link">
        ‚Üê Back to Products
    </a>

    <div class="product-detail">
        <!-- product image -->
         <div class="product-image">
            {% if product.image %}
            <img src="{{ product.image.url }}" alt="{{ product.name }}">
            {% endif %}
    </div>

    <!-- product information -->
    <div class="product-info">
        <h1>{{ product.name }}</h1>
        <p class="product-price">${{ product.price }}</p>
        <p class="product-description">{{ product.description }}</p>

        <div class="quantity-selector">
            <label for="quantity">Quantity:</label>
            <div class="quantity-controls">
                <button type="button" class="qty-btn" id="decrease">-</button>
                    <input type="number" id="quantity" name="quantity" value="1" min="1">
                    <button type="button" class="qty-btn" id="increase">+</button>
    </div>
</div>

<!-- add to cart button -->
 <form method="POST" action="{% url 'add_to_cart' product.id %}">
 {% csrf_token %}
    <input type="hidden" name="quantity" id="quantity-hidden" value="1">
    <button type="submit" class="btn-add-cart">Add to Cart</button>
       </form>
      </div>
   </div>
   <!-- review section -->
    <div class="review-section mt-5">
        <h3 class="text-white">Leave a Review</h3>

       {% if user.is_authenticated %}
       <form method="POST" class="review-form">
        {% csrf_token %}

        {{ review_form|crispy }}

        <button type="submit" class="btn btn-add-cart">Submit Review</button>
       </form>

       {% else %}
       <p class="text-light">
        You must be <a href="{% url 'account_login' %}?next={{ request.path }}">logged in</a> to leave a review.
       </p>
       {% endif %}
    </div>

    <div class="review-list mt-5">
        <h3 class="text-white">What Our Customers Say ({{ reviews.count }})</h3>

        {% if reviews %}
        {% for review in reviews %}
        <div class="card bg-dark text-white mb-3">
            <div class="card-body">
                <h5 class="card-title">{{ review.user.username }}</h5>

                <p class="card-text text-warning">
                    Rating: {{ review.rating }} / 5 Stars
                </p>
                <p class="card-text">{{ review.comment }}</p>
                
                <small class="text-muted">{{ review.created_at|date:"Y-m-d" }}</small>
            </div>
        </div>
        {% endfor %}
        {% else %}
        <p class="text-light">This product has no reviews yet.</p>
        {% endif %}
    </div>
 </div>
 {% endblock %}

 